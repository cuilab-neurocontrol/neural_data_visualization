<!DOCTYPE html>
<meta charset="utf-8">

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v6.js"></script>

<!-- Add a title for the control panel -->
<h2>Violin plot</h2>

<!-- Create a control panel -->
<div id="control-panel">
  <!-- Subheading for Canvas Size -->
  <details>
    <summary>Canvas Size</summary>
    <div class="control-row">
      <label for="width">Width (cm):</label>
      <input type="number" id="width" value="12" min="5" step="0.1" data-param="width">
      <label for="height">Height (cm):</label>
      <input type="number" id="height" value="8" min="5" step="0.1" data-param="height">
    </div>
  </details>

  <!-- Subheading for Margins -->
  <details>
    <summary>Margins</summary>
    <div class="control-row">
      <label for="margin-top">Top (cm):</label>
      <input type="number" id="margin-top" value="2" min="0" step="0.1">
      <label for="margin-right">Right (cm):</label>
      <input type="number" id="margin-right" value="2" min="0" step="0.1">
    </div>
    <div class="control-row">
      <label for="margin-bottom">Bottom (cm):</label>
      <input type="number" id="margin-bottom" value="2" min="0" step="0.1">
      <label for="margin-left">Left (cm):</label>
      <input type="number" id="margin-left" value="2" min="0" step="0.1">
    </div>
  </details>

  <!-- Subheading for Axis Margins -->
  <details>
    <summary>Axis</summary>
    <div class="control-row">
      <label for="show-outer-ticks">Show Outer Ticks:</label>
      <input type="checkbox" id="show-outer-ticks" checked>
    </div>
    <div class="control-row">
      <label for="show-x-axis">Show X Axis:</label>
      <input type="checkbox" id="show-x-axis" checked>
      <label for="show-y-axis">Show Y Axis:</label>
      <input type="checkbox" id="show-y-axis" checked>
    </div>
    <div class="control-row">
      <label for="axis-margin-x">X Margin (cm):</label>
      <input type="number" id="axis-margin-x" value="0.3" min="0" step="0.1">
      <label for="axis-margin-y">Y Margin (cm):</label>
      <input type="number" id="axis-margin-y" value="0" min="0" step="0.1">
    </div>
    <!-- Subheading for Axis and Tick Styling -->
    <div class="control-row">
      <label for="axis-line-width">Line Width (px):</label>
      <input type="number" id="axis-line-width" value="2" min="1" step="0.1">
      <label for="tick-line-width">Tick Width (px):</label>
      <input type="number" id="tick-line-width" value="2" min="1" step="0.1">
    </div>
    <div class="control-row">
      <label for="tick-font-size">Font Size (px):</label>
      <input type="number" id="tick-font-size" value="18" min="1" step="1">
      <label for="tick-length">Tick Length (px):</label>
      <input type="number" id="tick-length" value="6" min="1" step="1">
    </div>
    <div class="control-row">
      <label for="tick-positions">xTick Positions:</label>
      <input type="text" id="x-tick-positions" value="0,10,20,30,40,50,60,70,80,90,100">
      <label for="tick-labels">xTick Labels:</label>
      <input type="text" id="x-tick-labels" value="0, ,20, , 40, ,60, ,80, ,100 ">
    </div>
    <div class="control-row">
      <label for="tick-positions">yTick Positions:</label>
      <input type="text" id="y-tick-positions" value="4,6,8">
      <label for="tick-labels">yTick Labels:</label>
      <input type="text" id="y-tick-labels" value="4,6,8">
    </div>
    <div class="control-row">
      <label for="tick-font-family">Tick Font Family:</label>
      <select id="tick-font-family">
        <option value="Arial">Arial</option>
        <option value="Courier New">Courier New</option>
        <option value="Times New Roman">Times New Roman</option>
        <option value="Verdana">Verdana</option>
      </select>
      <label for="tick-orientation">Tick Orientation:</label>
      <select id="tick-orientation">
        <option value="outward">Outward</option>
        <option value="inward">Inward</option>
      </select>
    </div>
    <div class="control-row">
      <label for="x-domain-min">X Domain Min:</label>
      <input type="number" id="x-domain-min" value="0" step="1">
      <label for="x-domain-max">X Domain Max:</label>
      <input type="number" id="x-domain-max" value="100" step="1">
    </div>
    <div class="control-row">
      <label for="y-domain-min">Y Domain Min:</label>
      <input type="number" id="y-domain-min" value="4" step="1">
      <label for="y-domain-max">Y Domain Max:</label>
      <input type="number" id="y-domain-max" value="8" step="1">
    </div>
    <div class="control-row">
      <label for="x-label">X Axis Label:</label>
      <input type="text" id="x-label" value="Time from saccade onset (ms)">
      <label for="x-label-font-size">Font Size (px):</label>
      <input type="number" id="x-label-font-size" value="18" min="1" step="1">
      <label for="x-label-font-family">Font Family:</label>
      <select id="x-label-font-family">
        <option value="Arial">Arial</option>
        <option value="Courier New">Courier New</option>
        <option value="Times New Roman">Times New Roman</option>
        <option value="Verdana">Verdana</option>
      </select>
      <label for="show-x-label">Show X Label:</label>
      <input type="checkbox" id="show-x-label" checked>
    </div>
    <div class="control-row">
      <label for="y-label">Y Axis Label:</label>
      <input type="text" id="y-label" value="Firing Rate (Hz)">
      <label for="y-label-font-size">Font Size (px):</label>
      <input type="number" id="y-label-font-size" value="18" min="1" step="1">
      <label for="y-label-font-family">Font Family:</label>
      <select id="y-label-font-family">
        <option value="Arial">Arial</option>
        <option value="Courier New">Courier New</option>
        <option value="Times New Roman">Times New Roman</option>
        <option value="Verdana">Verdana</option>
      </select>
      <label for="show-y-label">Show Y Label:</label>
      <input type="checkbox" id="show-y-label" checked>
    </div>
  </details>
  <!-- Subheading for Scale Bar Styling -->
  <details>
    <summary>Scale Bar Styling</summary>
    <div class="control-row">
      <label for="show-scale-bar">Show Scale Bar:</label>
      <input type="checkbox" id="show-scale-bar">
    </div>
    <div class="control-row">
      <label for="x-scale-bar-position-x">X Bar PosX (px):</label>
      <input type="number" id="x-scale-bar-position-x" value="0" min="0" step="1">
      <label for="x-scale-bar-position-y">X Bar PosY (px):</label>
      <input type="number" id="x-scale-bar-position-y" value="20" min="0" step="1">
      
    </div>
    <div class="control-row">
      <label for="x-scale-bar-width">X Bar Width (px):</label>
      <input type="number" id="x-scale-bar-width" value="2" min="1" step="0.1">
      <label for="x-scale-bar-length">X Bar Len (units):</label>
      <input type="number" id="x-scale-bar-length" value="100" min="1" step="1">
    </div>
    <div class="control-row">
      <label for="x-scale-bar-label">X Bar Label:</label>
      <input type="text" id="x-scale-bar-label" value="100 units">
      <label for="x-scale-bar-label-orientation">X Orientation:</label>
      <select id="x-scale-bar-label-orientation">
        <option value="outward">Outward</option>
        <option value="inward">Inward</option>
      </select>
    </div>
    <div class="control-row">
      <label for="x-scale-bar-font-size">X Bar Font Size (px):</label>
      <input type="number" id="x-scale-bar-font-size" value="12" min="1" step="1">
      <label for="x-scale-bar-label-distance">X Label Distance (px):</label>
      <input type="number" id="x-scale-bar-label-distance" value="20" min="0" step="1">
    </div>
    <div class="control-row">
      <label for="x-scale-bar-font-family">X Bar Font Family:</label>
      <select id="x-scale-bar-font-family">
        <option value="Arial">Arial</option>
        <option value="Courier New">Courier New</option>
        <option value="Times New Roman">Times New Roman</option>
        <option value="Verdana">Verdana</option>
      </select>
    </div>

    <div class="control-row">
      <label for="y-scale-bar-position-x">Y Bar PosX (px):</label>
      <input type="number" id="y-scale-bar-position-x" value="20" min="0" step="1">
      <label for="y-scale-bar-position-y">Y Bar PosY (px):</label>
      <input type="number" id="y-scale-bar-position-y" value="20" min="0" step="1">
    </div>
    <div class="control-row">
      <label for="y-scale-bar-width">Y Bar Width (px):</label>
      <input type="number" id="y-scale-bar-width" value="2" min="1" step="0.1">
      <label for="y-scale-bar-length">Y Bar Len (units):</label>
      <input type="number" id="y-scale-bar-length" value="2" min="1" step="1">
    </div>
    <div class="control-row">
      <label for="y-scale-bar-label">Y Bar Label:</label>
      <input type="text" id="y-scale-bar-label" value="100 units">
      <label for="y-scale-bar-label-orientation">Y Orientation:</label>
      <select id="y-scale-bar-label-orientation">
        <option value="outward">Outward</option>
        <option value="inward">Inward</option>
      </select>
    </div>

    <div class="control-row">
      <label for="y-scale-bar-font-size">Y Bar Font Size (px):</label>
      <input type="number" id="y-scale-bar-font-size" value="12" min="1" step="1">
      <label for="y-scale-bar-label-distance">Y Label Distance (px):</label>
      <input type="number" id="y-scale-bar-label-distance" value="20" min="0" step="1">
    </div>
    <div class="control-row">
      <label for="y-scale-bar-font-family">Y Bar Font Family:</label>
      <select id="y-scale-bar-font-family">
        <option value="Arial">Arial</option>
        <option value="Courier New">Courier New</option>
        <option value="Times New Roman">Times New Roman</option>
        <option value="Verdana">Verdana</option>
      </select>
    </div>
  </details>

  <!-- Subheading for Group Padding -->
  <details>
    <summary>Group Padding</summary>
    <div class="control-row">
      <label for="xseries-padding">Series Padding (xSeries):</label>
      <input type="number" id="xseries-padding" value="0.2" min="0" max="1" step="0.01">
      <label for="xgroup-padding">Group Padding (xGroup):</label>
      <input type="number" id="xgroup-padding" value="0.01" min="0" max="1" step="0.01">
    </div>
  </details>

  <!-- Update Button -->
  <!-- Title Settings -->
  <details>
    <summary>Title Settings</summary>
    <div class="control-row">
      <label for="chart-title">Chart Title:</label>
      <input type="text" id="chart-title" value="simple spikes">
      <label for="show-title">Show Title:</label>
      <input type="checkbox" id="show-title" checked>
    </div>
    <div class="control-row">
      <label for="title-font-size">Font Size (px):</label>
      <input type="number" id="title-font-size" value="18" min="1" step="1">
      <label for="title-font-family">Font Family:</label>
      <select id="title-font-family">
        <option value="Arial">Arial</option>
        <option value="Courier New">Courier New</option>
        <option value="Times New Roman">Times New Roman</option>
        <option value="Verdana">Verdana</option>
      </select>
    </div>
    <div class="control-row">
      <label for="title-font-weight">Font Weight:</label>
      <select id="title-font-weight">
        <option value="normal">Normal</option>
        <option value="bold">Bold</option>
        <option value="bolder">Bolder</option>
        <option value="lighter">Lighter</option>
      </select>
      <label for="title-distance">Distance (pt):</label>
      <input type="number" id="title-distance" value="6" min="0" step="1">
    </div>
  </details>

  <!-- Data Series Upload -->
  <details>
    <summary>Data Series Upload</summary>
    <div class="control-row">
      <label for="data-files">Upload CSV Files:</label>
      <input type="file" id="data-files" multiple accept=".csv">
    </div>
    <div class="control-row">
      <label for="data-url">Or Data URL:</label>
      <input type="text" id="data-url" value=https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/iris.csv placeholder="Enter CSV URL">
      <button id="add-url">Add URL</button>
    </div>
    <!-- Container where each series control block will be appended -->
    <div id="series-controls"></div>
  </details>

  <!-- 多组假设检验参考线设置 -->
  <details>
    <summary>Hypothesis Reference Lines</summary>
    <div id="ref-lines-list"></div>
    <div class="control-row">
      <label>Y:</label>
      <input type="number" id="ref-line-y" value="6" step="0.1">
      <label>X1 (px):</label>
      <input type="number" id="ref-line-x1" value="50" step="1">
      <label>X2 (px):</label>
      <input type="number" id="ref-line-x2" value="350" step="1">
    </div>
    <div class="control-row">
      <label>Label:</label>
      <input type="text" id="ref-line-label" value="p < 0.05">
      <label>Label Size:</label>
      <input type="number" id="ref-line-label-size" value="16" min="8" max="48" step="1">
      <label>Label Distance (px):</label>
      <input type="number" id="ref-line-label-dist" value="8" step="1">
      <button id="add-ref-line" type="button">Add Reference Line</button>
    </div>
  </details>

  <div class="control-row">
    <button id="update" data-param="update">Update</button>
    <button id="save-svg-btn" type="button">Export to svg</button>
  </div>
</div>

<!-- Create a div where the graph will take place -->
<div id="my_dataviz" data-width="10" data-height="8"></div>

<div id="violin-centers-panel" style="margin:10px 0; font-size:14px; color:#333;"></div>

<!-- Add CSS for styling -->
<style>
  #control-panel {
    display: flex;
    flex-direction: column;
    gap: 15px; /* 增加子标题和内容之间的间距 */
    max-width: 600px; /* 增加宽度，避免换行 */
    margin-bottom: 20px;
  }

  .control-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 10px; /* 增加元素之间的间距 */
    flex-wrap: nowrap; /* 禁止换行 */
  }

  .control-row label {
    flex: 0 0 150px; /* 调整标签宽度，避免换行 */
    text-align: right;
  }

  .control-row input {
    flex: 1; /* 输入框占据剩余空间 */
    max-width: 100px; /* 限制输入框宽度 */
  }

  .control-row button {
    flex: 1;
    padding: 5px;
    max-width: 150px; /* 限制按钮宽度 */
  }

  h3 {
    margin: 0;
    font-size: 1.2em;
    font-weight: bold;
  }

  .series-control {
    border: 1px solid #ccc;
    padding: 5px;
    margin: 10px 0;
  }

  .series-control h3 {
    margin: 0 0 5px 0;
    font-size: 1em;
  }
</style>

<script src="./chart.js"></script>
